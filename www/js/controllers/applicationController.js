applicationController=function($scope,$ionicModal,$timeout,$location,$http){verifyVersion(),window.SEND_TIMEOUT&&clearTimeout(SEND_TIMEOUT),$scope.loginData={},$scope.appVersion=APP_VERSION,$scope.doLogoff=function(){return confirm("Deseja mesmo sair? Seus dados ser√£o perdidos.")?(localStorage.clear(),void(window.location="#/app/login")):0},$ionicModal.fromTemplateUrl("templates/login.html",{scope:$scope}).then(function(modal){$scope.modal=modal}),$scope.closeLogin=function(){$scope.modal.hide()},$scope.login=function(){$scope.modal.show()},$scope.doLogin=function(){console.log("Doing login",$scope.loginData),$timeout(function(){$scope.closeLogin()},1e3)},"/app/login"==$location.path()||localStorage.user_email&&localStorage.user_token||(window.location="#/app/login"),$scope.sendData=function(){SEND_TIMEOUT&&clearTimeout(SEND_TIMEOUT),$scope.sendModels("pedidos","pedido",function(){$scope.sendModels("sem_pedidos","sem_pedido",function(){})})},$scope.sendModels=function(type,apiModel,success){if($scope.sendingData)return 0;$scope.sendingData=!0;var models=$localData.findAll($http,type,!1);for(var i in models){var model=models[i];model.errors&&delete model.errors}$localData.saveAll(models,type);var send=function(callback){models=$localData.findAll($http,type,!1);var model=models[0],allWithError=!0;for(var i in models){var errors=models[i].errors;if(!errors){allWithError=!1,model=models[i];break}}if(allWithError||!models.length)return callback(),0;var data=$localData.serialize(apiModel,model);$http.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",$http.post(API_URL+"/"+type+".json",data+"&user_email="+localStorage.user_email+"&user_token="+localStorage.user_token).success(function(){$localData.delete($http,type,"__id",model.__id),$scope.sendingData=!1;var roteiro=$localData.find($http,"roteiros","sequencia",model.__roteiro);roteiro["status_"+type]=STATUS_SENT,roteiro.errors="",$localData.update($http,"roteiros","sequencia",roteiro),send(callback)}).error(function(data){if(data.base){var roteiro=$localData.find($http,"roteiros","sequencia",model.__roteiro);roteiro["status_"+type]=STATUS_SENT_ERROR,roteiro.errors=data.base.join(" "),$localData.update($http,"roteiros","sequencia",roteiro),model.errors=data.base.join(" "),$localData.update($http,type,"__id",model),send(callback)}else{var roteiro=$localData.find($http,"roteiros","sequencia",model.__roteiro);roteiro["status_"+type]=STATUS_SENT_ERROR,roteiro.errors="Sem rede",$localData.update($http,"roteiros","sequencia",roteiro),model.errors="Sem rede",$localData.update($http,type,"__id",model),$scope.sendingData=!1,send(callback)}})};send(function(){$scope.sendingData=!1,success&&success()})},SEND_TIMEOUT=setTimeout(function(){$scope.sendData()},6e4)};